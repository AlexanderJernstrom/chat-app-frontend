(this.webpackJsonpclient=this.webpackJsonpclient||[]).push([[0],{108:function(e,n,t){"use strict";t.r(n);var a=t(1),r=t.n(a),o=t(71),l=t.n(o),i=(t(85),t(29)),c=t(10),u=t(28),s=t(23),d=t(12),m=t(25),g=t(8);function v(){var e=Object(m.a)(["\n    mutation CreateUser($name: String!, $email: String!, $password: String!) {\n  createUser(name: $name, email: $email, password: $password)\n}\n    "]);return v=function(){return e},e}function b(){var e=Object(m.a)(["\n    query GetServers {\n  getServers {\n    id\n    name\n  }\n}\n    "]);return b=function(){return e},e}function h(){var e=Object(m.a)(["\n    query GetServer($id: String!) {\n  getServer(id: $id) {\n    server {\n      name\n    }\n    channels {\n      id\n      name\n    }\n    messages {\n      body\n      user {\n        name\n      }\n      channelId\n      createdAt\n    }\n  }\n  getMembersInServer(serverId: $id) {\n    name\n    id\n  }\n}\n    "]);return h=function(){return e},e}function p(){var e=Object(m.a)(["\n    mutation SendMessage($channelId: String!, $message: String!) {\n  sendMessage(message: $message, channelId: $channelId) {\n    body\n  }\n}\n    "]);return p=function(){return e},e}function f(){var e=Object(m.a)(["\n    mutation Login($email: String!, $password: String!) {\n  login(email: $email, password: $password) {\n    accessToken\n  }\n}\n    "]);return f=function(){return e},e}function E(){var e=Object(m.a)(["\n    mutation InviteMember($email: String!, $serverId: String!) {\n  inviteMember(email: $email, serverId: $serverId)\n}\n    "]);return E=function(){return e},e}function S(){var e=Object(m.a)(["\n    query GetMessages($channelId: String!) {\n  getMessages(channelId: $channelId) {\n    body\n    id\n    user {\n      id\n      name\n    }\n    createdAt\n  }\n}\n    "]);return S=function(){return e},e}function w(){var e=Object(m.a)(["\n    subscription GetMessagesSub($channelId: String!) {\n  getMessage(channelId: $channelId) {\n    body\n    user {\n      name\n      id\n    }\n    channelId\n    createdAt\n  }\n}\n    "]);return w=function(){return e},e}function j(){var e=Object(m.a)(["\n    mutation CreateServer($name: String!) {\n  createServer(name: $name)\n}\n    "]);return j=function(){return e},e}var y=Object(g.gql)(j());var O=Object(g.gql)(w());Object(g.gql)(S());var C=Object(g.gql)(E());var I=Object(g.gql)(f());var k=Object(g.gql)(p());var x=Object(g.gql)(h());var $=Object(g.gql)(b());var M=Object(g.gql)(v());var A=function(){var e,n=Object(a.useState)({email:"",password:""}),t=Object(d.a)(n,2),o=t[0],l=t[1],i=(e={update:function(e,n){var t=n.data;(null===t||void 0===t?void 0:t.login.accessToken)&&(localStorage.setItem("authorization",t.login.accessToken),localStorage.removeItem("credentials"))}},g.useMutation(I,e)),m=Object(d.a)(i,1)[0];return Object(a.useEffect)((function(){localStorage.getItem("credentials")&&l(localStorage.getItem("credentials"))}),[]),r.a.createElement("div",null,localStorage.getItem("authorization")?r.a.createElement(c.a,{to:"/"}):null,r.a.createElement("form",{onSubmit:function(e){return e.preventDefault()}},r.a.createElement("input",{onChange:function(e){return l(Object(s.a)(Object(s.a)({},o),{},Object(u.a)({},e.target.name,e.target.value)))},name:"email",placeholder:"email"}),r.a.createElement("input",{onChange:function(e){return l(Object(s.a)(Object(s.a)({},o),{},Object(u.a)({},e.target.name,e.target.value)))},name:"password",placeholder:"password",type:"password"}),r.a.createElement("button",{onClick:function(){return m({variables:o})}},"Login")))},q=function(){var e,n=Object(a.useState)({name:"",email:"",password:""}),t=Object(d.a)(n,2),o=t[0],l=t[1],i=(e={update:function(e,n){var t=n.data;!0===(null===t||void 0===t?void 0:t.createUser)&&localStorage.setItem("credentials",JSON.stringify(o))}},g.useMutation(M,e)),m=Object(d.a)(i,2),v=m[0],b=m[1].error;return r.a.createElement("div",null,localStorage.getItem("credentials")?r.a.createElement(c.a,{to:"/login"}):null,r.a.createElement("form",{style:{display:"grid",gridTemplateRows:"repeat(1, 1fr)",width:"50%",marginLeft:"25%"},onSubmit:function(e){e.preventDefault()}},r.a.createElement("input",{onChange:function(e){return l(Object(s.a)(Object(s.a)({},o),{},Object(u.a)({},e.target.name,e.target.value)))},placeholder:"Name",name:"name"}),r.a.createElement("input",{onChange:function(e){return l(Object(s.a)(Object(s.a)({},o),{},Object(u.a)({},e.target.name,e.target.value)))},placeholder:"Email",name:"email"}),r.a.createElement("input",{onChange:function(e){return l(Object(s.a)(Object(s.a)({},o),{},Object(u.a)({},e.target.name,e.target.value)))},placeholder:"passsword",type:"password",name:"password"}),r.a.createElement("button",{type:"submit",onClick:function(){return v({variables:o})}},"Register account")),r.a.createElement("p",null,null===b||void 0===b?void 0:b.message))},T=function(){var e,n=(e={context:{headers:{token:localStorage.getItem("authorization")}}},g.useQuery($,e)),t=n.data,o=(n.error,n.loading,function(e){return g.useMutation(y,e)}({context:{headers:{token:localStorage.getItem("authorization")}}})),l=Object(d.a)(o,1)[0],c=Object(a.useState)(""),u=Object(d.a)(c,2),s=u[0],m=u[1];return r.a.createElement("div",null,r.a.createElement("h1",{style:{textAlign:"center"}},"Chatify"),r.a.createElement("h2",{style:{marginLeft:"1rem"}},"Your servers"),r.a.createElement("div",{style:{width:"50%",boxShadow:"0 5px 2px 0 rgba(0, 0, 0, 0.16), 0 0 0 1px rgba(0, 0, 0, 0.08)",backgroundColor:"#203A4C",display:"flex",justifyContent:"center",marginLeft:"25%"}},null===t||void 0===t?void 0:t.getServers.map((function(e){return r.a.createElement("div",{style:{display:"flex",justifyContent:"center",width:"4rem",height:"4rem",borderRadius:"50%",backgroundColor:"#264A63",marginBottom:"0.5rem",marginTop:"0.5rem",boxShadow:"0 5px 2px 0 rgba(0, 0, 0, 0.16), 0 0 0 1px rgba(0, 0, 0, 0.08)"}},r.a.createElement(i.b,{to:"/server/".concat(e.id),style:{color:"white",textDecoration:"none"}},e.name))}))),r.a.createElement("input",{style:{borderLeft:"none",borderRight:"none",borderTop:"none",outline:"none",backgroundColor:"transparent",color:"white"},onChange:function(e){return m(e.target.value)},placeholder:"Name of server"}),r.a.createElement("button",{onClick:function(){l({variables:{name:s}})}},"Create a new server"))},L=(t(94),t(75)),z=Object(L.a)((function(e){return{selectedChannel:null,selectChannel:function(n){return e((function(e){return{selectedChannel:n}}))}}})),D=t(79),R=t(76),B=function(e){var n,t=e.initialMessages,o=e.idParam,l=e.channelName,i=z((function(e){return e.selectedChannel})),c=Object(a.useRef)(null),u=Object(a.useState)(""),s=Object(d.a)(u,2),m=s[0],v=s[1],b=(n={variables:{channelId:i},onSubscriptionData:function(e){var n,t=e.client,a=e.subscriptionData.data,r=t.readQuery({query:x,variables:{id:o}});console.log(null===a||void 0===a?void 0:a.getMessage);var l={messages:[].concat(Object(D.a)(r.getServer.messages),[null===a||void 0===a?void 0:a.getMessage])};console.log(r,l),t.writeQuery({query:x,data:{getServer:{messages:l.messages}},variables:{id:o}}),c.current.scrollTop=null===(n=c.current)||void 0===n?void 0:n.scrollHeight}},g.useSubscription(O,n)).data,h=function(e){return g.useMutation(k,e)}({context:{headers:{token:localStorage.getItem("authorization")}}}),p=Object(d.a)(h,1)[0];return Object(a.useEffect)((function(){var e;c.current.scrollTop=null===(e=c.current)||void 0===e?void 0:e.scrollHeight}),[i]),Object(a.useEffect)((function(){Object(R.setTimeout)((function(){var e;c.current.scrollTop=null===(e=c.current)||void 0===e?void 0:e.scrollHeight}),500)}),[b]),r.a.createElement("div",null,r.a.createElement("div",{style:{backgroundColor:"#3F0E40"}},r.a.createElement("h2",{style:{color:"white"}},l)),r.a.createElement("div",{ref:c,style:{overflowY:"scroll",height:"40rem",width:"100%",border:"1px solid grey",backgroundColor:"white"}},null===t||void 0===t?void 0:t.map((function(e){return r.a.createElement("div",{style:{color:"#5B5A5B"}},r.a.createElement("p",{style:{fontSize:"12px"}},r.a.createElement("strong",{style:{marginRight:"0.5rem"}},e.user.name),new Date(e.createdAt).toDateString()),r.a.createElement("p",null,e.body))}))),r.a.createElement("form",{style:{width:"100%",backgroundColor:"#E8F5FB",height:"10rem"},onSubmit:function(e){e.preventDefault()}},r.a.createElement("textarea",{placeholder:"Message #".concat(l),onChange:function(e){return v(e.target.value)},value:m,rows:6,style:{width:"99.7%",borderTop:"none",borderLeft:"none",borderRight:"none",backgroundColor:"transparent",outline:"none",resize:"none"}}),r.a.createElement("div",null,r.a.createElement("button",{style:{width:"10%",backgroundColor:"#007A5A",outline:"none",border:"none",borderRadius:"5px",color:"white",boxShadow:"0 5px 2px 0 rgba(0, 0, 0, 0.16), 0 0 0 1px rgba(0, 0, 0, 0.08)"},onClick:function(){p({variables:{channelId:i,message:m}}),v("")}},"Send"))))},N=(t(97),function(e){var n,t,o=Object(a.useState)(""),l=Object(d.a)(o,2),c=l[0],u=l[1],s=(t={context:{headers:{token:localStorage.getItem("authorization")}},variables:{id:e.match.params.id},onCompleted:function(e){console.log(e),E(e.getServer.channels[0].id)}},g.useQuery(x,t)),m=s.data,v=s.loading,b=s.error,h=function(e){return g.useMutation(C,e)}({update:function(e,n){var t=n.data;!0===(null===t||void 0===t?void 0:t.inviteMember)?window.location.reload():!1===(null===t||void 0===t?void 0:t.inviteMember)&&alert("Something went wrong, please try again")},context:{headers:{token:localStorage.getItem("authorization")}}}),p=Object(d.a)(h,1)[0],f=z((function(e){return e.selectedChannel})),E=z((function(e){return e.selectChannel}));return r.a.createElement("div",null,r.a.createElement("div",null,v?r.a.createElement("p",null,"...loading"):null),r.a.createElement("div",null,b?r.a.createElement("p",null,b.message):null),r.a.createElement(i.b,{to:"/"},r.a.createElement("button",null,"Go back to servers")),r.a.createElement("div",{style:{backgroundColor:"#3F0E40"}},r.a.createElement("h2",{style:{textAlign:"center",color:"white"}},null===m||void 0===m?void 0:m.getServer.server.name)),r.a.createElement("div",{style:{display:"flex",justifyContent:"left",width:"100%"}},r.a.createElement("div",{style:{width:"15%",backgroundColor:"#3F0E40"}},r.a.createElement("h1",null,"Channels"),null===m||void 0===m?void 0:m.getServer.channels.map((function(e){return r.a.createElement("div",{onClick:function(){return E(e.id)},style:{backgroundColor:e.id===f?"#1164A3":"transparent",color:"#AA94AA",border:"none",outline:"none",cursor:"pointer",height:"2rem"}},r.a.createElement("h5",null," # ",e.name))})),r.a.createElement("input",{style:{width:"100%",borderTop:"none",borderLeft:"none",borderRight:"none",outline:"none",backgroundColor:"transparent",color:"white"},placeholder:"Name of the channel you want to create"})),v?r.a.createElement("p",null,"...loading"):r.a.createElement("div",{style:{width:"75%"}},r.a.createElement(B,{idParam:e.match.params.id,initialMessages:null===m||void 0===m?void 0:m.getServer.messages.filter((function(e){return e.channelId===f})),channelName:null===m||void 0===m||null===(n=m.getServer.channels.find((function(e){return e.id===f})))||void 0===n?void 0:n.name})),r.a.createElement("div",null,r.a.createElement("h1",null,"Members"),null===m||void 0===m?void 0:m.getMembersInServer.map((function(e){return r.a.createElement("div",{style:{marginLeft:"5%",marginBottom:"10%"}},r.a.createElement("h4",null,e.name))})),r.a.createElement("div",{style:{marginLeft:"2%"}},r.a.createElement("label",null,"Invite user"),r.a.createElement("div",null,r.a.createElement("input",{placeholder:"Users email",onChange:function(e){return u(e.target.value)},style:{width:"60%"}}),r.a.createElement("button",{style:{width:"35%"},onClick:function(){return p({variables:{email:c,serverId:e.match.params.id}})}},"Invite user"))))))});var F=function(){return r.a.createElement(i.a,null,r.a.createElement(c.b,{path:"/register",exact:!0,component:q}),r.a.createElement(c.b,{path:"/login",exact:!0,component:A}),r.a.createElement(c.b,{path:"/",exact:!0,component:T}),r.a.createElement(c.b,{path:"/server/:id",exact:!0,component:N}),r.a.createElement(c.b,{path:"/server/channel/:id",exact:!0,component:B}))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var G=t(77),H=t(2),P=new g.HttpLink({uri:"https://chat-app-server.vercel.app/graphql"}),Q=new G.a({uri:"ws://chat-app-server.vercel.app/graphql",options:{reconnect:!0,connectionParams:{token:localStorage.getItem("authorization")}}}),U=Object(g.split)((function(e){var n=e.query,t=Object(H.p)(n);return"OperationDefinition"===t.kind&&"subscription"===t.operation}),Q,P),J=new g.ApolloClient({link:U,cache:new g.InMemoryCache});l.a.render(r.a.createElement(g.ApolloProvider,{client:J},r.a.createElement(F,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))},80:function(e,n,t){e.exports=t(108)},85:function(e,n,t){},94:function(e,n,t){},97:function(e,n,t){}},[[80,1,2]]]);
//# sourceMappingURL=main.14485169.chunk.js.map